---
title: mongodb 复制集群
tags: [mongodb]
categories: [mongodb]
---

### 两种结点
```
数据结点: 存储数据, 可以充当主从结点
投票结点: 负责选举, 不存储数据, 不能充当主从结点
```

### 主从原理oplog
- 作用： 记录主结点的写入操作, 充当复制源
- 特新： 封顶表Capped collection 滚动写入
- 默认大小: 64位linux, windows的可用空间的5%
- 复制时间: 滚动写入, 要把握被重写的时候,导致失效

### 大多数原则
大多数原则: 当集群的存活的结点大于1/2的时候, 才会触发选举(可以增加投票结点, 突破1/2原则)

### 触发选举
- 主节点挂了
- 主节点网络不可达(整个集群检测到主节点不可达)
- 降级rs.stepDown()

### 脏数据
当主节点挂了之后, 未同步的数据将成为脏数据, 恢复这个结点之后, 将会同步新的主节点的数据, 并将这个数据当到rollback, 保证集群的数据统一.
